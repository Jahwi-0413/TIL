# 0426

- recoil

## recoil

---

### ì‹œì‘

```
npm install recoil

RecoilRoot ë¡œ ë¶€ëª¨ ê°ì‹¸ê¸°
```

### ğŸ§ª atom

í•˜ë‚˜ì˜ ìƒíƒœ ì¡°ê°. ì–´ë–¤ componentì—ì„œë“  ì½ê³  ì“¸ ìˆ˜ ìˆìŒ. componentëŠ” atomì„ êµ¬ë…í•´ atomì´ ì—…ë°ì´íŠ¸ ë˜ë©´ ë¦¬ë Œë”ë§ í•˜ë„ë¡ í•  ìˆ˜ ìˆìŒ.

```tsx
//define
const arrState = atom({
	key : "ArrAtom",
	default : "",
})

//use
const [arr, setArr] = useRecoilState(arrState);

//only value
const arr = useRecoilValue(arrState);
//only set
const setArr = useSetRecoilState(arrState);ğŸ”®
```

### ğŸ”® selector

stateì—ì„œ **íŒŒìƒëœ state**ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŒ. textì˜ length, textì˜ ê¸¸ì´ ë‘ ë°° ë“±ë“±ì˜ ê¸°ëŠ¥ì´ ê°€ëŠ¥í•´ì§

```tsx
const arrFilterState = atom({
	key : "Filter",
	default : "All",
})

const filteredArrState = selector({
	key : "FilteredArr",
	get : ({get}) => {
		const filter = get(arrFilterState)
		const arr = get(arrState)

		switch(filter){
			case "All" return list;
			//...
		}
	}
})
```

`filteredArrState`ëŠ” arrFilterStateì™€ arrState ë‘˜ ë‹¤ ì¶”ì í•¨.

ë‘˜ ì¤‘ í•˜ë‚˜ê°€ ì—…ë°ì´íŠ¸ ë ë•Œ ë‹¤ì‹œ ì‹¤í–‰í•¨

selectorëŠ” get, set ë‘ ì†ì„±ì´ ëª¨ë‘ ìˆì–´ì•¼ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŒ

### â± asynchronouse data queries

ë°ì´í„°ì˜ íë¦„ì´ **ë¹„ë™ê¸°**ì¼ë•Œë„ ìƒíƒœ, íŒŒìƒ ìƒíƒœë¥¼ í™œìš©í•  ìˆ˜ ìˆìŒ

selectorì˜ **ê²°ê³¼ê°’ì„ Promiseë¡œ** ê°ì‹¸ì„œ ë°˜í™˜í•˜ë©´ ë¨

```tsx
const currentUserNameQuery = selector({
  key: "CurrentUserName",
  get: async ({ get }) => {
    const response = await myDBQuery({
      userID: get(currentUserIDState),
    });
    return response.name;
  },
});
```

ìœ„ ì˜ˆì œëŠ” `currentUserIDState`ê°€ ë³€ê²½ë ë•Œë§ˆë‹¤ ë‹¤ì‹œ ì‹¤í–‰ë˜ê³  ê²°ê³¼ê°’ì€ ìºì‹±ë¨

qeuryê°€ ë¹„ë™ê¸°ì´ê³  react ë Œë”ë§ì€ ë™ê¸°ì¸ë° queryì˜ promiseê°€ í•´ê²°ë˜ê¸° ì „ê¹Œì§€ëŠ” ì–´ë–¡í• ê¹Œ?

- reactì˜ Suspenseë€?

  ```tsx
  <Suspense fallback={<Loading />}>
    <SomeComponent />
  </Suspense>
  ```

  childrenì´ loadingì´ ì™„ë£Œí• ë•Œê¹Œì§€ ëŒ€ì²´ UIë¥¼ ë¡œë”©í•  ìˆ˜ ìˆìŒ
  `useRecoilValueLoadable()` hookìœ¼ë¡œ í˜„ì ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•ë„ ìˆìŒ

  ```tsx
  const userNameLoadable = useRecoilValueLoadable(userNameQuery(userID));

  switch (userNameLoadable.state) {
    case "hasValue":
      return <div>{userNameLoadable.contents}</div>;
    case "loading":
      return <div>Loading...</div>;
    case "hasError":
      throw userNameLoadable.contents;
  }
  ```

```tsx
<RecoilRoot>
  <React.Suspense fallback={<div>Loading...</div>}>
    <CurrentUserInfo />
  </React.Suspense>
</RecoilRoot>
```

**ì˜¤ë¥˜**ê°€ ë‚œ ê²½ìš°

```tsx
<ErrorBoundary>
  <React.Suspense fallback={<div>Loading...</div>}>
    <CurrentUserInfo />
  </React.Suspense>
</ErrorBoundary>
```

reactì˜ `<ErrorBoundary>` ì‚¬ìš©

### queries with parameter

```tsx
const userNameQuery = selectorFamily({
  key: "UserName",
  get: (userID) => async () => {
    const response = await myDBQuery({ userID });
    if (response.error) {
      throw response.error;
    }
    return response.name;
  },
});
```

`selectorFamily`ë¥¼ ì‚¬ìš©í•´ íŒŒë¼ë¯¸í„°ë¡œ selectorì— ê°’ì„ ë„˜ê²¨ì¤„ ìˆ˜ ìˆìŒ

propsì˜ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ queryë¥¼ êµ¬ì„±í•˜ëŠ” ê²½ìš° ì‚¬ìš© ê°€ëŠ¥

### multiple queries

ì—¬ëŸ¬ selectorë¥¼ í˜¼í•©í•´ ë°ì´í„°ì˜ íë¦„ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŒ

```tsx
const currentUserInfoQuery = selector({
  key: "CurrentUserInfoQuery",
  get: ({ get }) => get(userInfoQuery(get(currentUserIDState))),
});
```
